import hashlib
import logging
import requests
from config import MALWARE_BAZAAR_API

def calculate_file_hash(file_data):
    """Calculate SHA256 hash of file data."""
    sha256_hash = hashlib.sha256()
    sha256_hash.update(file_data)
    return sha256_hash.hexdigest()

def check_hash_malicious(file_hash):
    """Check if the hash is malicious using MalwareBazaar."""
    try:
        response = requests.post(MALWARE_BAZAAR_API, data={'query': 'get_info', 'hash': file_hash})
        if response.status_code == 200:
            data = response.json()
            return 'data' in data  # Malicious if data exists
    except Exception as e:
        logging.error(f"Error checking hash {file_hash}: {str(e)}")
    return False  # Not malicious